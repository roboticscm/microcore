<script context="module">
	import { loadResource } from '$lib/i18n';

	export const load = async ({ fetch }) => {
		const resourcePromise = loadResource(fetch);
		await Promise.all([resourcePromise]);
		return {
			status: 200,
			props: {
				loaded: true
			}
		};
	};
</script>

<script>
    import '../../../static/style/index.scss';
	import '../../init';
    import Nav from '/src/components/nav/index.svelte'
    import { onMount } from 'svelte';
    import { config } from '/src/config/config';
	import { AppStore } from '/src/store/app';
	import JsonParseBigInt from 'json-parse-bigint';
	import { t } from '$lib/i18n';
	import { App } from "$lib/constants";
	import { SettingService } from '/src/services/setting';

    const { notify$, currentMenu$ } = AppStore;

    onMount(() => {
		const evtSource = new EventSource(`${config.messagingServer}/notify`);
		evtSource.onmessage = (event) => {
			notify$.next(JsonParseBigInt(event.data));
		};
    })

	const reloadSettings = () => {
		SettingService.getInitialUserSetting().then((res) => {
			console.log(res);
		});
	}
	reloadSettings();

</script>

<svelte:head>
    <title>{App.NAME} - {$t(($currentMenu$||{}).name)}</title>
</svelte:head>

<main class="main w-100 h-100">
    <section class="main__nav">
        <div class="main__nav__content h-100">
            <Nav></Nav>
        </div>
        
    </section>
    
    <section class="main__content">
        <slot></slot>
    </section>
</main>
